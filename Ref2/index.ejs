<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Asset Manager</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <header>
    <h1>자산 관리자</h1>
    <div class="total-balance">총 자산: <%= total.toLocaleString() %>원</div>
  </header>
  <main>
    <aside class="sidebar">
      <h2>계좌 목록</h2>
      <ul>
        <% accounts.forEach(account => { %>
          <li class="<%= selectedAccount == account.id ? 'active' : '' %>">
            <a href="/?account_id=<%= account.id %>"><%= account.name %> (<%= account.balance.toLocaleString() %>원)</a>
          </li>
        <% }) %>
      </ul>
      <button class="btn add-btn" onclick="toggleForm('account-form')">새 계좌 추가</button>
      <form id="account-form" class="hidden-form" action="/accounts" method="post">
        <input type="text" name="name" placeholder="계좌 이름" required>
        <button class="btn" type="submit">추가</button>
      </form>
    </aside>
    <section class="content">
      <div class="actions">
        <button class="btn" onclick="toggleForm('transaction-form')">새 거래 추가</button>
        <button class="btn" onclick="toggleForm('transfer-form')">자산 이전</button>
      </div>
      <form id="transaction-form" class="hidden-form" action="/transactions" method="post">
        <select name="account_id" required>
          <option value="">계좌 선택</option>
          <% accounts.forEach(acc => { %>
            <option value="<%= acc.id %>"><%= acc.name %></option>
          <% }) %>
        </select>
        <select name="type" required>
          <option value="deposit">입금</option>
          <option value="withdraw">출금</option>
        </select>
        <input type="number" name="amount" placeholder="금액" required min="1">
        <input type="text" name="description" placeholder="설명">
        <button class="btn" type="submit">저장</button>
      </form>
      <form id="transfer-form" class="hidden-form" action="/transfers" method="post">
        <select name="from_id" required>
          <option value="">보내는 계좌</option>
          <% accounts.forEach(acc => { %>
            <option value="<%= acc.id %>"><%= acc.name %></option>
          <% }) %>
        </select>
        <select name="to_id" required>
          <option value="">받는 계좌</option>
          <% accounts.forEach(acc => { %>
            <option value="<%= acc.id %>"><%= acc.name %></option>
          <% }) %>
        </select>
        <input type="number" name="amount" placeholder="금액" required min="1">
        <input type="text" name="description" placeholder="설명">
        <button class="btn" type="submit">이전</button>
      </form>
      <h2>거래 내역 <%= selectedAccount ? `( ${accounts.find(a => a.id == selectedAccount).name} )` : '' %></h2>
      <table>
        <thead>
          <tr>
            <th>날짜</th>
            <th>계좌</th>
            <th>설명</th>
            <th>입금</th>
            <th>출금</th>
            <th>잔고</th>
          </tr>
        </thead>
        <tbody>
          <% if (transactions.length === 0) { %>
            <tr><td colspan="6">거래 내역이 없습니다.</td></tr>
          <% } else { %>
            <% transactions.forEach(tx => { %>
              <tr class="<%= tx.type.includes('transfer') ? 'transfer-row' : '' %>">
                <td><%= tx.date.toLocaleString('ko-KR') %></td>
                <td><%= tx.account_name %></td>
                <td><%= tx.description %></td>
                <td class="positive"><%= (tx.type === 'deposit' || tx.type === 'transfer_in') ? tx.amount.toLocaleString() : '' %></td>
                <td class="negative"><%= (tx.type === 'withdraw' || tx.type === 'transfer_out') ? tx.amount.toLocaleString() : '' %></td>
                <td><%= tx.balance_after.toLocaleString() %></td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </section>
  </main>
  <script>
    function toggleForm(id) {
      const form = document.getElementById(id);
      form.classList.toggle('hidden-form');
    }
  </script>
</body>
</html>